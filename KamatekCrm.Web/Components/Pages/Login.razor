@page "/login"
@using KamatekCrm.Shared.DTOs
@using KamatekCrm.Web.Services
@inject IAuthService AuthService
@inject NavigationManager Navigation
@inject ISnackbar Snackbar

<MudCard Class="mx-auto mt-5" Style="max-width: 400px;">
    <MudCardHeader>
        <CardHeaderContent>
            <MudText Typo="Typo.h5" Align="Align.Center">Giriş Yap</MudText>
        </CardHeaderContent>
    </MudCardHeader>
    <MudCardContent>
        <MudForm @ref="form" @bind-IsValid="@success">
            <MudTextField T="string" Label="Kullanıcı Adı" Required="true" RequiredError="Kullanıcı adı gerekli!"
                          @bind-Value="loginRequest.Username" />
            <MudTextField T="string" Label="Şifre" InputType="InputType.Password" Required="true"
                          RequiredError="Şifre gerekli!" @bind-Value="loginRequest.Password" />
        </MudForm>
    </MudCardContent>
    <MudCardActions>
        <MudButton Variant="Variant.Filled" Color="Color.Primary" Disabled="@(!success)" OnClick="LoginAsync"
                   Class="ml-auto">Giriş</MudButton>
    </MudCardActions>
</MudCard>

@code {
    bool success;
    MudForm form;
    LoginRequest loginRequest = new LoginRequest();

    private async Task LoginAsync()
    {
        var result = await AuthService.LoginAsync(loginRequest);
        if (result.Success)
        {
            Navigation.NavigateTo("/");
        }
        else
        {
            Snackbar.Add(result.Message, Severity.Error);
        }
    }
}