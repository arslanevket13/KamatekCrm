<UserControl x:Class="KamatekCrm.Views.AnalyticsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:KamatekCrm.ViewModels"
             xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
             Background="#1a1a2e">
    
    <UserControl.DataContext>
        <vm:AnalyticsViewModel/>
    </UserControl.DataContext>
    
    <Grid>
        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <StackPanel Margin="20">
                
                <!-- Header -->
                <Grid Margin="0,0,0,20">
                    <TextBlock Text="ðŸ“Š Ä°ÅŸ ZekasÄ± Dashboard" 
                               FontSize="28" FontWeight="Bold" Foreground="White"/>
                    <Button Content="ðŸ”„ Yenile" 
                            HorizontalAlignment="Right"
                            Command="{Binding RefreshCommand}"
                            Background="#3498db" Foreground="White"
                            Padding="15,8" BorderThickness="0"
                            Cursor="Hand"/>
                </Grid>

                <!-- KPI Cards -->
                <UniformGrid Columns="4" Margin="0,0,0,25">
                    <!-- Toplam Gelir -->
                    <Border CornerRadius="12" Margin="5" Padding="20">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop Color="#2ECC71" Offset="0"/>
                                <GradientStop Color="#27AE60" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <StackPanel>
                            <TextBlock Text="ðŸ’° Toplam Gelir (6 Ay)" Foreground="White" FontSize="13" Opacity="0.9"/>
                            <TextBlock Text="{Binding TotalRevenue, StringFormat='â‚º{0:N0}'}" 
                                       Foreground="White" FontSize="28" FontWeight="Bold" Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Toplam Gider -->
                    <Border CornerRadius="12" Margin="5" Padding="20">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop Color="#E74C3C" Offset="0"/>
                                <GradientStop Color="#C0392B" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <StackPanel>
                            <TextBlock Text="ðŸ“¤ Toplam Gider (6 Ay)" Foreground="White" FontSize="13" Opacity="0.9"/>
                            <TextBlock Text="{Binding TotalExpense, StringFormat='â‚º{0:N0}'}" 
                                       Foreground="White" FontSize="28" FontWeight="Bold" Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Aktif Ä°ÅŸler -->
                    <Border CornerRadius="12" Margin="5" Padding="20">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop Color="#3498DB" Offset="0"/>
                                <GradientStop Color="#2980B9" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <StackPanel>
                            <TextBlock Text="ðŸ”§ Aktif Ä°ÅŸler" Foreground="White" FontSize="13" Opacity="0.9"/>
                            <TextBlock Text="{Binding ActiveJobs}" 
                                       Foreground="White" FontSize="28" FontWeight="Bold" Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Toplam MÃ¼ÅŸteri -->
                    <Border CornerRadius="12" Margin="5" Padding="20">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop Color="#9B59B6" Offset="0"/>
                                <GradientStop Color="#8E44AD" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <StackPanel>
                            <TextBlock Text="ðŸ‘¥ Toplam MÃ¼ÅŸteri" Foreground="White" FontSize="13" Opacity="0.9"/>
                            <TextBlock Text="{Binding TotalCustomers}" 
                                       Foreground="White" FontSize="28" FontWeight="Bold" Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>
                </UniformGrid>

                <!-- Charts Row 1 -->
                <Grid Margin="0,0,0,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Financial Trend Chart -->
                    <Border Grid.Column="0" Background="#252541" CornerRadius="12" Padding="20" Margin="0,0,10,0">
                        <StackPanel>
                            <TextBlock Text="ðŸ“ˆ 6 AylÄ±k Finansal Trend" Foreground="White" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,15"/>
                            <lvc:CartesianChart Height="280"
                                                Series="{Binding FinancialSeries}"
                                                XAxes="{Binding FinancialXAxes}"
                                                TooltipPosition="Top"
                                                LegendPosition="Bottom"
                                                LegendTextPaint="{x:Null}"/>
                        </StackPanel>
                    </Border>

                    <!-- Category Pie Chart -->
                    <Border Grid.Column="1" Background="#252541" CornerRadius="12" Padding="20" Margin="10,0,0,0">
                        <StackPanel>
                            <TextBlock Text="ðŸ“Š Servis Kategorileri" Foreground="White" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,15"/>
                            <lvc:PieChart Height="280"
                                          Series="{Binding CategorySeries}"
                                          LegendPosition="Bottom"/>
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- Charts Row 2 -->
                <Border Background="#252541" CornerRadius="12" Padding="20">
                    <StackPanel>
                        <TextBlock Text="ðŸ† En Ã‡ok Satan 5 ÃœrÃ¼n" Foreground="White" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,15"/>
                        <lvc:CartesianChart Height="200"
                                            Series="{Binding TopProductsSeries}"
                                            YAxes="{Binding TopProductsYAxes}"
                                            TooltipPosition="Right"/>
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>
        
        <!-- Loading Overlay -->
        <Border Background="#80000000" Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}">
            <TextBlock Text="YÃ¼kleniyor..." FontSize="24" Foreground="White" 
                       HorizontalAlignment="Center" VerticalAlignment="Center"/>
        </Border>
    </Grid>
</UserControl>
