<UserControl x:Class="KamatekCrm.Views.TicketsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">


    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Müşteri Seçimi -->
        <StackPanel Grid.Row="0" Margin="0,0,0,10">
            <TextBlock Text="Müşteri:" FontWeight="Bold"/>
            <ComboBox ItemsSource="{Binding AllCustomers}"
                      SelectedValue="{Binding SelectedTicket.CustomerId}"
                      SelectedValuePath="Id"
                      DisplayMemberPath="Name"
                      Margin="0,5,0,0"
                      Padding="5"/>
        </StackPanel>

        <StackPanel Grid.Row="1" Margin="0,0,0,10">
            <TextBox Text="{Binding SelectedTicket.Title, UpdateSourceTrigger=PropertyChanged}"
             Tag="İş Kayıt"
             Foreground="Gray"
             GotFocus="TextBox_GotFocus"
             LostFocus="TextBox_LostFocus"
             Margin="0,5,0,0" Padding="5"/>

            <TextBox Text="{Binding SelectedTicket.Description, UpdateSourceTrigger=PropertyChanged}"
             Tag="Açıklama"
             Foreground="Gray"
             GotFocus="TextBox_GotFocus"
             LostFocus="TextBox_LostFocus"
             Margin="0,5,0,0" Padding="5" Height="80" AcceptsReturn="True" TextWrapping="Wrap"/>
        </StackPanel>

        <!-- Butonlar -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10">
            <Button Content="Müşteri Ekle" Command="{Binding OpenAddCustomerCommand}" Width="120"/>
            <Button Content="Ekle" Command="{Binding AddCommand}" Width="100" Margin="5" Padding="5"/>
            <Button Content="Güncelle" Command="{Binding UpdateCommand}" Width="100" Margin="5" Padding="5"/>
            <Button Content="Sil" Command="{Binding DeleteCommand}" Width="100" Margin="5" Padding="5"/>
        </StackPanel>

        <!-- Liste -->
        <ListBox Grid.Row="3" ItemsSource="{Binding Tickets}" SelectedItem="{Binding SelectedTicket}" Height="250" Margin="0,10,0,0">
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Border BorderBrush="#ccc" BorderThickness="0,0,0,1" Padding="10">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding Id}" Width="40" FontWeight="Bold"/>
                            <TextBlock Text="{Binding Title}" Width="200"/>
                            <!-- 💡 Müşteri Adı -->
                            <TextBlock Text="{Binding Customer.Name}" Width="150" Foreground="Blue" FontWeight="SemiBold"/>
                            <TextBlock Text="{Binding Description}" TextTrimming="CharacterEllipsis" MaxWidth="300"/>
                        </StackPanel>
                    </Border>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>

        <!-- Detay Paneli (Opsiyonel) -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" Margin="0,10,0,0" HorizontalAlignment="Left">
            <TextBlock Text="Seçili Kayıt Detayları:" FontWeight="Bold" Margin="0,0,10,0"/>
            <TextBlock Text="{Binding SelectedTicket.Customer.Name, StringFormat='Müşteri: {0}'}" Margin="0,0,10,0"/>
            <TextBlock Text="{Binding SelectedTicket.Customer.Phone, StringFormat='Telefon: {0}'}" Margin="0,0,10,0"/>
            <TextBlock Text="{Binding SelectedTicket.CreatedDate, StringFormat='Tarih: {0:dd.MM.yyyy}'}"/>
        </StackPanel>
    </Grid>
  </UserControl>