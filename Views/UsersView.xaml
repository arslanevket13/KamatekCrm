<UserControl x:Class="KamatekCrm.Views.UsersView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:KamatekCrm.ViewModels"
             Background="{StaticResource BackgroundColor}">
    
    <UserControl.DataContext>
        <vm:UsersViewModel/>
    </UserControl.DataContext>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0">
                <TextBlock Text="ðŸ‘¥ KullanÄ±cÄ± YÃ¶netimi" 
                           FontSize="28" FontWeight="Bold"
                           Foreground="{StaticResource TextPrimaryColor}"/>
                <TextBlock Text="Sistem kullanÄ±cÄ±larÄ±nÄ± gÃ¶rÃ¼ntÃ¼le ve yÃ¶net"
                           FontSize="12" Foreground="#757575" Margin="0,4,0,0"/>
            </StackPanel>

            <!-- Current User Info -->
            <Border Grid.Column="2" Background="#E3F2FD" CornerRadius="8" Padding="16,8">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="ðŸ‘¤" FontSize="20" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <StackPanel>
                        <TextBlock Text="{Binding CurrentUserName}" FontWeight="SemiBold" FontSize="13"/>
                        <TextBlock Text="{Binding CurrentUserRole}" FontSize="11" Foreground="#1976D2"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Toolbar -->
        <Border Grid.Row="1" Style="{StaticResource CardPanel}" Padding="16" Margin="0,0,0,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" MaxWidth="300"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Search -->
                <Grid Grid.Column="0">
                    <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                             Style="{StaticResource ModernTextBox}"
                             Height="40" Padding="36,8,12,8"/>
                    <TextBlock Text="ðŸ”" FontSize="16" VerticalAlignment="Center" 
                               Margin="12,0,0,0" IsHitTestVisible="False"/>
                </Grid>

                <!-- Actions -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button Content="ðŸ”„ Yenile"
                            Style="{StaticResource SecondaryButton}"
                            Command="{Binding RefreshCommand}"
                            Height="40" Padding="16,0" Margin="0,0,8,0"/>
                    
                    <Button Content="âž• Yeni KullanÄ±cÄ±"
                            Style="{StaticResource ModernButton}"
                            Command="{Binding AddUserCommand}"
                            Height="40" Padding="16,0"
                            IsEnabled="{Binding IsAdmin}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Users Grid -->
        <Border Grid.Row="2" Style="{StaticResource CardPanel}" Padding="0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <DataGrid Grid.Row="0"
                          ItemsSource="{Binding Users}"
                          SelectedItem="{Binding SelectedUser}"
                          Style="{StaticResource ModernDataGrid}"
                          ColumnHeaderStyle="{StaticResource ModernDataGridColumnHeader}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          SelectionMode="Single"
                          RowHeight="50">
                    
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="#" Binding="{Binding Id}" Width="50">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="Margin" Value="12,0"/>
                                    <Setter Property="Foreground" Value="#9E9E9E"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Header="Ad Soyad" Binding="{Binding AdSoyad}" Width="*" MinWidth="150">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="Margin" Value="12,0"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Header="KullanÄ±cÄ± AdÄ±" Binding="{Binding Username}" Width="150">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="Margin" Value="12,0"/>
                                    <Setter Property="Foreground" Value="#616161"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTemplateColumn Header="Rol" Width="120">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border CornerRadius="12" Padding="10,4" HorizontalAlignment="Left" Margin="12,0">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="#E0E0E0"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Role}" Value="Admin">
                                                        <Setter Property="Background" Value="#FFF3E0"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Role}" Value="Technician">
                                                        <Setter Property="Background" Value="#E3F2FD"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <TextBlock FontSize="12" FontWeight="SemiBold">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Role}" Value="Admin">
                                                            <Setter Property="Text" Value="ðŸ‘‘ Patron"/>
                                                            <Setter Property="Foreground" Value="#E65100"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Role}" Value="Technician">
                                                            <Setter Property="Text" Value="ðŸ”§ Personel"/>
                                                            <Setter Property="Foreground" Value="#1565C0"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Role}" Value="Viewer">
                                                            <Setter Property="Text" Value="ðŸ‘ï¸ Ä°zleyici"/>
                                                            <Setter Property="Foreground" Value="#616161"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTemplateColumn Header="Durum" Width="100">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock VerticalAlignment="Center" Margin="12,0">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsActive}" Value="True">
                                                        <Setter Property="Text" Value="âœ… Aktif"/>
                                                        <Setter Property="Foreground" Value="#2E7D32"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsActive}" Value="False">
                                                        <Setter Property="Text" Value="âŒ Pasif"/>
                                                        <Setter Property="Foreground" Value="#C62828"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTextColumn Header="Son GiriÅŸ" Binding="{Binding LastLoginDate, StringFormat=dd.MM.yyyy HH:mm}" Width="140">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="Margin" Value="12,0"/>
                                    <Setter Property="Foreground" Value="#757575"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Action Buttons -->
                <Border Grid.Row="1" BorderThickness="0,1,0,0" BorderBrush="#E0E0E0" Padding="16">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <!-- Edit Button -->
                        <Button Content="âœï¸ DÃ¼zenle"
                                Style="{StaticResource SecondaryButton}"
                                Command="{Binding EditUserCommand}"
                                Height="36" Padding="16,0" Margin="0,0,8,0"/>

                        <!-- Set Password Button -->
                        <Button Content="ðŸ” Åžifre Belirle"
                                Height="36" Padding="16,0" Margin="0,0,8,0"
                                Command="{Binding SetPasswordCommand}"
                                Background="#FFF3E0" Foreground="#E65100"
                                BorderBrush="#FFCC80" BorderThickness="1"
                                Cursor="Hand">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" 
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            CornerRadius="6">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>

                        <!-- Quick Reset Button -->
                        <Button Content="ðŸ”‘ 1234'e SÄ±fÄ±rla"
                                Style="{StaticResource SecondaryButton}"
                                Command="{Binding ResetPasswordCommand}"
                                Height="36" Padding="16,0" Margin="0,0,8,0"/>
                        
                        <!-- Delete Button -->
                        <Button Content="ðŸ—‘ï¸ Sil"
                                Height="36" Padding="16,0"
                                Command="{Binding DeleteUserCommand}"
                                Background="#FFEBEE" Foreground="#C62828"
                                BorderBrush="#FFCDD2" BorderThickness="1"
                                Cursor="Hand">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" 
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            CornerRadius="6">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</UserControl>
