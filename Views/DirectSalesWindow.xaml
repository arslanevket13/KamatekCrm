<Window x:Class="KamatekCrm.Views.DirectSalesWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="ðŸ’° Perakende SatÄ±ÅŸ (POS)" 
        Height="700" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="#F5F5F5">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        
        <!-- BÃ¼yÃ¼k Buton Stili -->
        <Style x:Key="LargePaymentButton" TargetType="Button">
            <Setter Property="Height" Value="60"/>
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Margin" Value="0,5"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="8"
                                Padding="20,10">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Opacity" Value="0.9"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.5"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="15">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="6*"/>  <!-- Sol: ÃœrÃ¼n KataloÄŸu -->
            <ColumnDefinition Width="15"/>
            <ColumnDefinition Width="4*"/>  <!-- SaÄŸ: Sepet -->
        </Grid.ColumnDefinitions>

        <!-- ====================== -->
        <!-- SOL PANEL: ÃœRÃœN KATALOÄžU -->
        <!-- ====================== -->
        <Border Grid.Column="0" Background="White" CornerRadius="12" Padding="15">
            <Border.Effect>
                <DropShadowEffect BlurRadius="10" Opacity="0.1" ShadowDepth="2"/>
            </Border.Effect>
            
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/> <!-- Header + Depo -->
                    <RowDefinition Height="Auto"/> <!-- Arama -->
                    <RowDefinition Height="*"/>    <!-- DataGrid -->
                </Grid.RowDefinitions>

                <!-- Header -->
                <Grid Grid.Row="0" Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="200"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“¦" FontSize="24" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <TextBlock Text="ÃœrÃ¼n KataloÄŸu" FontSize="20" FontWeight="Bold" 
                                   Foreground="#1565C0" VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <!-- Depo SeÃ§imi -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                        <TextBlock Text="Depo:" VerticalAlignment="Center" Margin="0,0,8,0" Foreground="#666"/>
                        <ComboBox ItemsSource="{Binding Warehouses}"
                                  SelectedItem="{Binding SelectedWarehouse}"
                                  DisplayMemberPath="Name"
                                  Width="140" Height="30"/>
                    </StackPanel>
                </Grid>

                <!-- Arama Kutusu -->
                <Border Grid.Row="1" Background="#F8F9FA" CornerRadius="8" Padding="12" Margin="0,0,0,15">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="ðŸ”" FontSize="18" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <TextBox Grid.Column="1" 
                                 Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                 FontSize="16"
                                 BorderThickness="0"
                                 Background="Transparent"
                                 TabIndex="0"
                                 FocusManager.FocusedElement="{Binding RelativeSource={RelativeSource Self}}"
                                 VerticalAlignment="Center">
                            <TextBox.Style>
                                <Style TargetType="TextBox">
                                    <Setter Property="Foreground" Value="#333"/>
                                </Style>
                            </TextBox.Style>
                        </TextBox>
                        <!-- Placeholder -->
                        <TextBlock Grid.Column="1" 
                                   Text="ÃœrÃ¼n adÄ±, model veya stok kodu ile ara..."
                                   Foreground="#999"
                                   VerticalAlignment="Center"
                                   IsHitTestVisible="False">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SearchText}" Value="">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </Grid>
                </Border>

                <!-- ÃœrÃ¼n DataGrid -->
                <DataGrid Grid.Row="2" 
                          ItemsSource="{Binding FilteredProducts}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          IsReadOnly="True"
                          SelectionMode="Single"
                          HeadersVisibility="Column"
                          GridLinesVisibility="Horizontal"
                          BorderThickness="0"
                          Background="White"
                          RowHeight="45"
                          ColumnHeaderHeight="40">

                    <DataGrid.ColumnHeaderStyle>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="Background" Value="#E3F2FD"/>
                            <Setter Property="Foreground" Value="#1565C0"/>
                            <Setter Property="FontWeight" Value="SemiBold"/>
                            <Setter Property="Padding" Value="12,8"/>
                            <Setter Property="BorderThickness" Value="0"/>
                        </Style>
                    </DataGrid.ColumnHeaderStyle>

                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Setter Property="Cursor" Value="Hand"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#F5F5F5"/>
                                </Trigger>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="#E3F2FD"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowStyle>

                    <DataGrid.Columns>
                        <!-- ÃœrÃ¼n AdÄ± -->
                        <DataGridTextColumn Header="ÃœrÃ¼n AdÄ±" Binding="{Binding ProductName}" Width="*">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="Margin" Value="12,0"/>
                                    <Setter Property="FontWeight" Value="Medium"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- Model -->
                        <DataGridTextColumn Header="Model" Binding="{Binding ModelName}" Width="120">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="Foreground" Value="#666"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- Stok -->
                        <DataGridTemplateColumn Header="Stok" Width="80">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border CornerRadius="4" Padding="6,2" HorizontalAlignment="Center">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="#E8F5E9"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding StockQuantity}" Value="0">
                                                        <Setter Property="Background" Value="#FFEBEE"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <TextBlock Text="{Binding StockQuantity}" 
                                                   FontWeight="Bold" HorizontalAlignment="Center">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="#4CAF50"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding StockQuantity}" Value="0">
                                                            <Setter Property="Foreground" Value="#F44336"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Fiyat -->
                        <DataGridTextColumn Header="Fiyat" Binding="{Binding SalePrice, StringFormat='{}{0:N2} â‚º'}" Width="100">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="HorizontalAlignment" Value="Right"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="Foreground" Value="#1565C0"/>
                                    <Setter Property="Margin" Value="0,0,12,0"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- Ekle Butonu -->
                        <DataGridTemplateColumn Header="" Width="70">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="âž•" 
                                            Command="{Binding DataContext.AddToCartCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                            CommandParameter="{Binding}"
                                            Background="#4CAF50"
                                            Foreground="White"
                                            FontSize="16"
                                            Width="40" Height="32"
                                            BorderThickness="0"
                                            Cursor="Hand"
                                            ToolTip="Sepete Ekle">
                                        <Button.Template>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" CornerRadius="6">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Button.Template>
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding StockQuantity}" Value="0">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                        <Setter Property="Opacity" Value="0.3"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>

        <!-- ====================== -->
        <!-- SAÄž PANEL: SEPET -->
        <!-- ====================== -->
        <Border Grid.Column="2" Background="White" CornerRadius="12" Padding="15">
            <Border.Effect>
                <DropShadowEffect BlurRadius="10" Opacity="0.1" ShadowDepth="2"/>
            </Border.Effect>
            
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/> <!-- Header -->
                    <RowDefinition Height="Auto"/> <!-- MÃ¼ÅŸteri -->
                    <RowDefinition Height="*"/>    <!-- Sepet DataGrid -->
                    <RowDefinition Height="Auto"/> <!-- Toplam -->
                    <RowDefinition Height="Auto"/> <!-- Butonlar -->
                    <RowDefinition Height="Auto"/> <!-- Status -->
                </Grid.RowDefinitions>

                <!-- Header -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,15">
                    <TextBlock Text="ðŸ›’" FontSize="24" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <TextBlock Text="Sepetim" FontSize="20" FontWeight="Bold" 
                               Foreground="#E65100" VerticalAlignment="Center"/>
                    <Border Background="#FFF3E0" CornerRadius="12" Padding="8,4" Margin="15,0,0,0"
                            Visibility="{Binding CartItemCount, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <TextBlock Text="{Binding CartItemCount, StringFormat='{}{0} Ã¼rÃ¼n'}" 
                                   Foreground="#E65100" FontWeight="SemiBold"/>
                    </Border>
                </StackPanel>

                <!-- MÃ¼ÅŸteri AdÄ± -->
                <Border Grid.Row="1" Background="#FFF8E1" CornerRadius="6" Padding="10" Margin="0,0,0,10">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="ðŸ‘¤" FontSize="14" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBox Grid.Column="1" 
                                 Text="{Binding CustomerName, UpdateSourceTrigger=PropertyChanged}"
                                 BorderThickness="0"
                                 Background="Transparent"
                                 FontSize="13"
                                 VerticalAlignment="Center"/>
                    </Grid>
                </Border>

                <!-- Sepet DataGrid -->
                <Border Grid.Row="2" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="6">
                    <DataGrid ItemsSource="{Binding CartItems}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              HeadersVisibility="Column"
                              GridLinesVisibility="None"
                              BorderThickness="0"
                              Background="White"
                              RowHeight="50">

                        <DataGrid.ColumnHeaderStyle>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="Background" Value="#FFF3E0"/>
                                <Setter Property="Foreground" Value="#E65100"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="Padding" Value="8,6"/>
                                <Setter Property="BorderThickness" Value="0"/>
                            </Style>
                        </DataGrid.ColumnHeaderStyle>

                        <DataGrid.Columns>
                            <!-- ÃœrÃ¼n -->
                            <DataGridTextColumn Header="ÃœrÃ¼n" Binding="{Binding ProductName}" Width="*" IsReadOnly="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="Margin" Value="8,0"/>
                                        <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <!-- Adet (+/-) -->
                            <DataGridTemplateColumn Header="Adet" Width="90">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Button Content="âˆ’" Width="24" Height="24" FontSize="14" FontWeight="Bold"
                                                    Background="#FFEBEE" Foreground="#D32F2F" BorderThickness="0"
                                                    Command="{Binding DataContext.DecreaseQuantityCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}"
                                                    Cursor="Hand">
                                                <Button.Template>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="{TemplateBinding Background}" CornerRadius="4">
                                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Button.Template>
                                            </Button>
                                            <TextBlock Text="{Binding Quantity}" Width="30" TextAlignment="Center" 
                                                       FontWeight="Bold" FontSize="14" VerticalAlignment="Center"/>
                                            <Button Content="+" Width="24" Height="24" FontSize="14" FontWeight="Bold"
                                                    Background="#E8F5E9" Foreground="#388E3C" BorderThickness="0"
                                                    Command="{Binding DataContext.IncreaseQuantityCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}"
                                                    Cursor="Hand">
                                                <Button.Template>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="{TemplateBinding Background}" CornerRadius="4">
                                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Button.Template>
                                            </Button>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <!-- Tutar -->
                            <DataGridTextColumn Header="Tutar" Binding="{Binding TotalPrice, StringFormat='{}{0:N2} â‚º'}" Width="80" IsReadOnly="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                        <Setter Property="Foreground" Value="#E65100"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <!-- Sil -->
                            <DataGridTemplateColumn Header="" Width="35">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="âœ•" 
                                                Command="{Binding DataContext.RemoveFromCartCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                CommandParameter="{Binding}"
                                                Background="Transparent"
                                                Foreground="#D32F2F"
                                                FontSize="14"
                                                FontWeight="Bold"
                                                BorderThickness="0"
                                                Cursor="Hand"
                                                ToolTip="Sil"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>

                <!-- Toplam -->
                <Border Grid.Row="3" Background="#FFF3E0" CornerRadius="8" Padding="15" Margin="0,15,0,10">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="TOPLAM" FontSize="18" FontWeight="Bold" 
                                   Foreground="#E65100" VerticalAlignment="Center"/>
                        <TextBlock Grid.Column="1" 
                                   Text="{Binding CartTotal, StringFormat='{}{0:N2} â‚º'}" 
                                   FontSize="28" FontWeight="Bold" 
                                   Foreground="#BF360C"/>
                    </Grid>
                </Border>

                <!-- Ã–deme ButonlarÄ± -->
                <StackPanel Grid.Row="4">
                    <Button Style="{StaticResource LargePaymentButton}"
                            Command="{Binding ProcessCashPaymentCommand}"
                            IsDefault="True"
                            Background="#4CAF50"
                            Foreground="White">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ’µ" FontSize="22" Margin="0,0,10,0"/>
                            <TextBlock Text="NAKÄ°T Ã–DEME" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Style="{StaticResource LargePaymentButton}"
                            Command="{Binding ProcessCardPaymentCommand}"
                            Background="#1976D2"
                            Foreground="White">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ’³" FontSize="22" Margin="0,0,10,0"/>
                            <TextBlock Text="KREDÄ° KARTI" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Content="ðŸ—‘ï¸ Sepeti Temizle"
                            Command="{Binding ClearCartCommand}"
                            Background="#FFEBEE"
                            Foreground="#D32F2F"
                            Height="35"
                            FontSize="13"
                            BorderThickness="0"
                            Margin="0,10,0,0"
                            Cursor="Hand">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border Background="{TemplateBinding Background}" CornerRadius="6">
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </StackPanel>

                <!-- Status -->
                <TextBlock Grid.Row="5" 
                           Text="{Binding StatusMessage}" 
                           Margin="0,10,0,0"
                           FontSize="12"
                           TextWrapping="Wrap">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="#D32F2F"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsActionSuccessful}" Value="True">
                                    <Setter Property="Foreground" Value="#388E3C"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
            </Grid>
        </Border>
    </Grid>
</Window>
